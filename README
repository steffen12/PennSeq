# Copyright (c) 2013, Yu Hu and Mingyao Li (Perelman School of Medicine, University of Pennsylvania)
# All rights reserved.
#########################

UPADATES:
	# 01/11/2017: Application of Pysam module was added

REQUIREMENTS:
	(i) Python v2.X	
	(ii) Pysam
	(iii) Indexed BAM file as input
	

#####################STEP(1)#########################
The perl script "PreProcess.pl" will give the compatible matrix of isoforms for each gene.

USAGE OF preprocess.pl:
"./PreProcess.pl -r RefSeqAnnotation -o Outputfile"

The RefSeqAnnotation file is downloaded from UCSC Genome Browers. The format is as follows
--------------------------------------------------------------------------------------------
#bin    name    chrom   strand  txStart txEnd   cdsStart        cdsEnd  exonCount       exonStarts      exonEnds        id      name2   cdsStartStat    cdsEndStat      exonFrames
774	NM_001251984	chr1	+	24828840		24863510		24859578	24861767	4	24828840,24857707,24859572,24861582,	24828953,24857881,24859744,24863510, 0 RCAN3 cmpl cmpl -1,-1,0,1,
774	NM_001251979	chr1	+	24828840		24863510		24840862	24861767	5	24828840,24840803,24857707,24859572,24861582,	24828953,24841057,24857881,24859744,24863510, 0 RCAN3 cmpl cmpl -1,0,0,0,1,
774	NM_001251977	chr1	+	24829386		24863510		24840862	24861767	5	24829386,24840803,24857707,24859572,24861582,	24829607,24841057,24857881,24859744,24863510, 0	RCAN3 cmpl cmpl	-1,0,0,0,1,
774	NM_001251981	chr1	+	24829386		24863510		24840862	24861767	4	24829386,24840803,24859572,24861582,		24829607,24841057,24859744,24863510,	      0	RCAN3 cmpl cmpl	-1,0,0,1,

---------------------------------------------------------------------------------------------
-r ---RefSeqAnnotation file

-o ---The file name that you want to save the results; it will be the input file for "pennseq.pl"

The file "RefSeqAnnotation_ECE1_example" is an example of RefSeqAnnotation.

The file "ISOFORM_Compatible_Matrix_example" is an example of the processed annotation by preprocess.pl


#####################STEP(2)#########################
The Python script "PennSeq.py" will calculate the relative abundance for each isoform.

USAGE OF pennseq.pl:

"python PennSeq.py -ref ISOFORM_Compatible_Matrix -bam Indexed_BAM_File -out Output_Result_FILE"

-bam ---Indexed_BAM_File is the mapping result file generated by mapping tools such as TopHat. 

-ref ---ISOFORM_Compatible_Matrix is from the output of preprocess.pl

-out ---The file name that you want to save the results

The data file "BAM_example.sorted.bam" is an example Indexed Bam File. 

The file "Output_Result_FILE" is an example of results file.

-------------------------------------------------------------------------------------
Contact inforamtion
For more information, addtional data and scripts (such as the simulation and plot codes), bug reports and comments, please contact Yu Hu via huyu1@mail.med.upenn.edu. 
